# 概要

チャットボットを試しに作ってみました．
応答の生成には OpenAI API をそのまま使っています．

生成 AI に書いてもらったものやらウェブから拾ってきたものをつなぎあわせただけの内容です．
ろくにエラー処理などもおこなっていません．
たとえば，応答を待たずに次の入力ができてしまうとか…．

実行環境は Ubuntu 24.04 です．

以下の内容も自分向けのメモになっています．

## Python 3 環境

Python 3 環境を外部と切り離すために venv を用います．
以下のようにすると， venv というディレクトリが作成され，その中に必要なファイルが展開されます．

```
$ python3 -m venv venv
```

切り離した環境を使い始めるときは以下のようにします．

```
$ source venv/bin/activate
```

シェルの頭に `(venv)` と表示されるようになるので，有効になっているかどうかは一目でわかります．

この状態では， `pip3 install` を使うと，切り離された環境にインストールされます．
グローバルな環境とか，ほかの開発に影響を与えずにいじれるのが良いところです．

初期状態からやり直したくなったときは， `rm -rf venv` して最初の手順からやり直せば大丈夫です．

インストールするモジュールは以下の通りです．

```
$ pip3 install websockets asyncio openai
```

## 構成

サーバには Python 3 を使い，クライアントには JavaScript を使っています．

- server
  - server.py
- client
  - client.html
  - client.js
  - style.css

単純すぎて説明するほどの内容はありません．

## API Key

OpenAI の API Key は環境変数 `OPENAI_API_KEY` から取っています．

## 通信

サーバとクライアントが WebSocket で接続して JSON 形式でリクエストとレスポンスを送受信します．
アドレスには `localhost:8765` を使っています．

サーバはクライアントから受け取ったリクエストを OpenAI API に渡し，レスポンスをクライアントに返します．

クライアントは入力された内容をサーバに渡し，レスポンスを表示します．

### Authorization

接続直後に `MySecretToken` という文字列をクライアント側が送るだけです．

### Request

クライアントがサーバに送るリクエストの書式です．

```json
{
  "type": "chat",
  "text": "リクエストの内容をここに記述します．",
  "timestamp": "2025-08-13T03:16:15.060Z"
}
```

`type`, `timestamp` は使っていないので意味がありません．
なんとなく入れただけです．

### Response

サーバがクライアントに送るレスポンスの書式です．
delta を使うようにしないと待ち時間が長くて使い勝手が悪いです．
しかし，実装は面倒になります．

```json
{
  "text": "レスポンスの差分が入ります．",
  "timestamp": "2025-08-13T03:16:15.060Z"
}
```
